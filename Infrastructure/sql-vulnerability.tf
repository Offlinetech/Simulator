module "alert_policy_sql_server_region1" {
  source = "../modules/sql/sql-alert-policy"

RESOURCE_GROUP_NAME = module.resource_group_region1.name
SERVER_NAME         = module.sql_server_region1.name
STATE               = var.SQL_ALERT_POLICY_STATE_RG1
}

module "vulnerability_assessment_sql_server_region1" {
  source = "../modules/sql/sql-vulnerability"

  SERVER_SECURITY_ALERT_POLICY_ID = module.alert_policy_sql_server_region1.id
  STORAGE_CONTAINER_PATH = "10.0.0.4"   # module.private_endpoint_storage_account_blob_region1
  STORAGE_ACCOUNT_ACCESS_KEY = module.storage_account_region1.access_key

}

module "alert_policy_sql_server_region2" {
  source = "../modules/sql/sql-alert-policy"

RESOURCE_GROUP_NAME = module.resource_group_region1.name
SERVER_NAME         = module.sql_server_region1.name
STATE               = var.SQL_ALERT_POLICY_STATE_RG2
}

module "vulnerability_assessment_sql_server_region2" {
  source = "../modules/sql/sql-vulnerability"

  SERVER_SECURITY_ALERT_POLICY_ID = module.alert_policy_sql_server_region2.id
  STORAGE_CONTAINER_PATH = "10.0.0.4"   # module.private_endpoint_storage_account_blob_region2
  STORAGE_ACCOUNT_ACCESS_KEY = module.storage_account_region2.access_key

}